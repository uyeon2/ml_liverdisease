import streamlit as st
import joblib
import time

from ml_final_text import preprocess
from liver_advise import liver_feedback

model = joblib.load("liver_model_final.pkl")

st.set_page_config(                  #ë¸Œë¼ìš°ì € íƒ­ì˜ ì´ë¦„ì„¤ì •
    page_title='ê°„ ì§ˆí™˜ ì˜ˆì¸¡ê¸°',
    page_icon='ğŸ§¬',
    layout='centered'
)

st.title("ğŸ§¬ ê°„ ì§ˆí™˜ ìœ„í—˜ë„ ì˜ˆì¸¡ê¸°")

st.header('1ï¸âƒ£ ê±´ê°• ìƒíƒœ ì…ë ¥')
user_input=st.text_area(
    "## ì•„ë˜ì— ë³¸ì¸ì˜ ë‚˜ì´, ì„±ë³„, ëª¸ë¬´ê²Œ, ìŒì£¼ëŸ‰, í¡ì—°ì—¬ë¶€, ìš´ë™ëŸ‰, ë‹¹ë‡¨, ê³ í˜ˆì••, ìœ ì „ë ¥, ê°„ìˆ˜ì¹˜ ë“± ê±´ê°•ìƒíƒœë¥¼ ì…ë ¥í•´ë³´ì„¸ìš”.",
    placeholder='''ì˜ˆ: ì €ëŠ” 55ì„¸ ë‚¨ìì…ë‹ˆë‹¤. ìˆ ì€ ì£¼ë§ì—ë§Œ ì¡°ê¸ˆì”© ë§ˆì‹œê³ , í¡ì—°ì€ í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. 
    ê°€ì¡± ì¤‘ì— ê°„ ì§ˆí™˜ ë³‘ë ¥ì´ ìˆì—ˆê³ , ë‹¹ë‡¨ëŠ” ì—†ìŠµë‹ˆë‹¤. ìš´ë™ì€ ê°€ë” ì‚°ì±…í•˜ëŠ” ì •ë„ì…ë‹ˆë‹¤. 
    í˜ˆì••ì€ ì •ìƒì´ì§€ë§Œ, ì „ë°˜ì ìœ¼ë¡œ ê±´ê°•ì´ ê±±ì •ë¼ì„œ í•œë²ˆ í™•ì¸í•´ë³´ê³  ì‹¶ì–´ìš”.
''',
height=200)
#placeholderì€ íšŒìƒ‰ìœ¼ë¡œ ë‚˜íƒ€ë‚˜ëŠ” ì˜ˆì‹œë¬¸ì¥

if st.button('ì˜ˆì¸¡í•˜ê¸°'):
    if user_input.strip() == '':       #ê³µë°±ë§Œ ì³¤ì„ ìˆ˜ë„ ìˆìœ¼ë‹ˆê¹Œ í™•ì¸ìš©
        st.warning('ê±´ê°• ìƒíƒœë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.')
    else:
        try:
            with st.spinner('ê°„ ì§ˆí™˜ ìœ„í—˜ë„ ê³„ì‚° ì¤‘...'):
                input_vector=preprocess(user_input)
                probability = model.predict_proba(input_vector)[0][1]  # ì–‘ì„±ì¼ í™•ë¥ 
            st.markdown("---")
            st.header('2ï¸âƒ£ ê°„ ì§ˆí™˜ ìœ„í—˜ë„ ê²°ê³¼')
            st.info(f"ì˜ˆì¸¡ ê²°ê³¼: ë‹¹ì‹ ì€ {probability * 100:.1f}%ì˜ í™•ë¥ ë¡œ ê°„ ì§ˆí™˜ì´ ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.")
            with st.spinner('ê±´ê°• í”¼ë“œë°± ìƒì„±ì¤‘...'):
                time.sleep(1.5)
                summary, tips = liver_feedback(probability)
            st.markdown("---")
            st.header('3ï¸âƒ£ ì‚¬ìš©ì ë§ì¶¤ ê±´ê°• í”¼ë“œë°±')
            st.subheader(summary)
            for t in tips:
                st.markdown(f"- {t}")
        except Exception as e:     #ì˜¤ë¥˜ ë– ë„ í”„ë¡œê·¸ë¨ì´ ë©ˆì¶”ì§€ ì•Šê³  ëŒ€ì‹  ì´ë ‡ê²Œ ì²˜ë¦¬í•´ë¼
            st.error(f'ì˜ˆì¸¡ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: {e}')  #ì—ëŸ¬ ë©”ì‹œì§€ë¥¼ eë¡œ ë‹´ì•„ì„œ ì¶œë ¥í•¨
            
with st.sidebar:
    st.markdown("## â„¹ï¸ ì •ë³´")   #writeê°€ ì•„ë‹Œ markdownìœ¼ë¡œ ê¸€ì”¨ì²´ ì¡°ì ˆ ê°€ëŠ¥
    st.markdown("- ì´ ì•±ì€ **ìì—°ì–´ ì…ë ¥ ê¸°ë°˜**ìœ¼ë¡œ ê°„ ì§ˆí™˜ ìœ„í—˜ë„ë¥¼ ì˜ˆì¸¡í•©ë‹ˆë‹¤.")
    st.markdown("- ì…ë ¥ ë‚´ìš©ì€ ì •ê·œí‘œí˜„ì‹ìœ¼ë¡œ ë¶„ì„ë˜ì–´ **10ê°€ì§€ ê±´ê°• ìš”ì†Œ**ë¥¼ ì¶”ì¶œí•©ë‹ˆë‹¤.")
    st.markdown("- ê²°ê³¼ëŠ” ë¨¸ì‹ ëŸ¬ë‹ ëª¨ë¸(`CatBoost`) ê¸°ë°˜ìœ¼ë¡œ ê³„ì‚°ë©ë‹ˆë‹¤.")  #ë¬¼ê²° ë°‘ì— ìˆëŠ” ë°±í‹±ìœ¼ë¡œ ê°ì‹¸ë©´ ì¸ë¼ì¸ìœ¼ë¡œ í‘œì‹œë¨
    st.markdown("- ì´ ì•±ì€ ì°¸ê³ ìš©ì´ë©°, **ì˜í•™ì  ì§„ë‹¨ì€ ì•„ë‹™ë‹ˆë‹¤.**")
	
    st.markdown("---")
    st.markdown("### ğŸ§ª ì‚¬ìš©ë²• ìš”ì•½")
    st.markdown("1. ìì‹ ì˜ ê±´ê°• ìƒíƒœë¥¼ ìì—°ì–´ë¡œ ì…ë ¥í•˜ì„¸ìš”.")
    st.markdown("2. [ì˜ˆì¸¡í•˜ê¸°] ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ê²°ê³¼ê°€ í‘œì‹œë©ë‹ˆë‹¤.")
    
    st.markdown('---')
    st.markdown("### ğŸ‘¥ íŒ€ ì •ë³´")
    st.markdown("**Made by ë‚¨í˜œì›, ì´ë¯¼í•˜, ì •ê°€ì€**")
    st.markdown("*2025-1 Machine Learning Term Project*")